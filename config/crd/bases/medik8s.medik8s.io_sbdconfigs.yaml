---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: sbdconfigs.medik8s.medik8s.io
spec:
  group: medik8s.medik8s.io
  names:
    kind: SBDConfig
    listKind: SBDConfigList
    plural: sbdconfigs
    singular: sbdconfig
  scope: Cluster
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: SBDConfig is the Schema for the sbdconfigs API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: SBDConfigSpec defines the desired state of SBDConfig.
            properties:
              image:
                description: |-
                  Image is the container image for the SBD agent DaemonSet
                  If not specified, defaults to sbd-agent from the same registry/org/tag as the operator
                type: string
              imagePullPolicy:
                default: IfNotPresent
                description: |-
                  ImagePullPolicy defines the pull policy for the SBD agent container image.
                  Valid values are Always, Never, and IfNotPresent.
                  Defaults to IfNotPresent for production stability.
                enum:
                - Always
                - Never
                - IfNotPresent
                type: string
              namespace:
                default: sbd-system
                description: Namespace is the namespace where the SBD agent DaemonSet
                  will be deployed
                type: string
              petIntervalMultiple:
                default: 4
                description: |-
                  PetIntervalMultiple defines the multiple used to calculate the pet interval from the watchdog timeout.
                  Pet interval = watchdog timeout / pet interval multiple.
                  This ensures the pet interval is always shorter than the watchdog timeout with a safety margin.
                  The value must be between 3.0 and 20.0, with 4.0 providing a good balance of safety and efficiency.
                format: int32
                maximum: 20
                minimum: 3
                type: integer
              sbdWatchdogPath:
                default: /dev/watchdog
                description: |-
                  SbdWatchdogPath is the path to the watchdog device on the host
                  If not specified, defaults to "/dev/watchdog"
                type: string
              staleNodeTimeout:
                default: 1h
                description: |-
                  StaleNodeTimeout defines how long to wait before considering a node stale and removing it from slot mapping
                  This timeout determines when inactive nodes are cleaned up from the shared SBD device slot assignments.
                  Nodes that haven't updated their heartbeat within this duration will be considered stale and their slots
                  will be freed for reuse by new nodes. The value must be at least 1 minute.
                pattern: ^([0-9]+(\.[0-9]+)?(ns|us|µs|ms|s|m|h))+$
                type: string
              watchdogTimeout:
                default: 60s
                description: |-
                  WatchdogTimeout defines the watchdog timeout duration for the hardware/software watchdog device.
                  This determines how long the system will wait before triggering a reboot if the watchdog is not pet.
                  The pet interval is calculated as watchdog timeout divided by the pet interval multiple.
                  The value must be between 10 seconds and 300 seconds (5 minutes).
                pattern: ^([0-9]+(\.[0-9]+)?(ns|us|µs|ms|s|m|h))+$
                type: string
            type: object
          status:
            description: SBDConfigStatus defines the observed state of SBDConfig.
            properties:
              daemonSetReady:
                description: DaemonSetReady indicates whether the SBD agent DaemonSet
                  is ready
                type: boolean
              readyNodes:
                description: ReadyNodes is the number of nodes where the SBD agent
                  is ready
                format: int32
                type: integer
              totalNodes:
                description: TotalNodes is the total number of nodes where the SBD
                  agent should be deployed
                format: int32
                type: integer
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
